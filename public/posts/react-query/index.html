<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>React Query | Victor De Grandis Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="How to use React Query on Nextjs React query is a tool for creating hooks for fetching, caching and updating asynchronous data repository.
Motivation Fetching data from your backend is one of the most performance killers features of any frontend, and it really helps to keep a copy of the fetched data in the browser, but it&rsquo;s not always possible, or convenient to build a Redux store, so react-query is a good alternative for managing API results without having to do a lot of work for it, and without having to fetch it again every time you need it.">
    <meta name="generator" content="Hugo 0.126.1">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/blog/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/blog/posts/react-query/">
    

    <meta property="og:url" content="http://localhost:1313/blog/posts/react-query/">
  <meta property="og:site_name" content="Victor De Grandis Blog">
  <meta property="og:title" content="React Query">
  <meta property="og:description" content="How to use React Query on Nextjs React query is a tool for creating hooks for fetching, caching and updating asynchronous data repository.
Motivation Fetching data from your backend is one of the most performance killers features of any frontend, and it really helps to keep a copy of the fetched data in the browser, but it’s not always possible, or convenient to build a Redux store, so react-query is a good alternative for managing API results without having to do a lot of work for it, and without having to fetch it again every time you need it.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-18T13:04:27-03:00">
    <meta property="article:modified_time" content="2024-05-18T13:04:27-03:00">

  <meta itemprop="name" content="React Query">
  <meta itemprop="description" content="How to use React Query on Nextjs React query is a tool for creating hooks for fetching, caching and updating asynchronous data repository.
Motivation Fetching data from your backend is one of the most performance killers features of any frontend, and it really helps to keep a copy of the fetched data in the browser, but it’s not always possible, or convenient to build a Redux store, so react-query is a good alternative for managing API results without having to do a lot of work for it, and without having to fetch it again every time you need it.">
  <meta itemprop="datePublished" content="2024-05-18T13:04:27-03:00">
  <meta itemprop="dateModified" content="2024-05-18T13:04:27-03:00">
  <meta itemprop="wordCount" content="321">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="React Query">
  <meta name="twitter:description" content="How to use React Query on Nextjs React query is a tool for creating hooks for fetching, caching and updating asynchronous data repository.
Motivation Fetching data from your backend is one of the most performance killers features of any frontend, and it really helps to keep a copy of the fetched data in the browser, but it’s not always possible, or convenient to build a Redux store, so react-query is a good alternative for managing API results without having to do a lot of work for it, and without having to fetch it again every time you need it.">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Victor De Grandis Blog
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">React Query</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-05-18T13:04:27-03:00">May 18, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h2 id="how-to-use-react-query-on-nextjs">How to use React Query on Nextjs</h2>
<p>React query is a tool for creating hooks for fetching, caching and updating asynchronous data <a href="https://github.com/TanStack/query">repository</a>.</p>
<h3 id="motivation">Motivation</h3>
<p>Fetching data from your backend is one of the most performance killers features of any frontend, and it really helps to keep a copy of the fetched data in the browser, but it&rsquo;s not always possible, or convenient to build a Redux store, so react-query is a good alternative for managing API results without having to do a lot of work for it, and without having to fetch it again every time you need it.
With react-query, you have a shared source for all components that use that data, with a cache and mutations for updating the state across your application.</p>
<h3 id="usage">Usage</h3>
<p>First, you have to configure the provider <code>QueryClientProvider</code> like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// _app.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">QueryClient</span>, <span style="color:#a6e22e">QueryClientProvider</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react-query&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">App</span>({<span style="color:#a6e22e">Component</span>, <span style="color:#a6e22e">pageProps</span>}) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">queryClientRef</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useRef</span>&lt;<span style="color:#f92672">QueryClient</span>&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">queryClientRef</span>.<span style="color:#a6e22e">current</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">queryClientRef</span>.<span style="color:#a6e22e">current</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">QueryClient</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">React.Fragment</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">Head</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">Head</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">QueryClientProvider</span> <span style="color:#a6e22e">client</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">queryClientRef</span>.<span style="color:#a6e22e">current</span>}&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">Component</span> {<span style="color:#a6e22e">...pageProps</span>} /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">QueryClientProvider</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">React.Fragment</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If you don&rsquo;t know what a provider is, visit <a href="https://reactjs.org/docs/context.html">the react docs</a>.</p>
<p>Secondly, you have to make a service, for example at <code>/lib/services/getClientsService.ts</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// /lib/hooks/getClientsService.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getClients</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">Promise</span>&lt;<span style="color:#f92672">NetworkResponse</span><span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">Client</span>&gt;<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">axios</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">`/api/clients`</span>).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And finally, a hook for consuming the service and giving react query the retry options:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// /lib/hooks/useClients.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">useClients() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">useQuery</span>&lt;<span style="color:#f92672">NetworkResponse</span><span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">Client</span>&gt;, <span style="color:#a6e22e">AxiosError</span><span style="color:#f92672">&gt;</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`/clients`</span>,
</span></span><span style="display:flex;"><span>    () <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">getClients</span>(),
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">retry</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">refetchOnWindowFocus</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">refetchOnReconnect</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">data</span>: <span style="color:#66d9ef">data</span>, <span style="color:#a6e22e">status</span> };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now you&rsquo;re good to go using the hook in every component necessary, like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Clients() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">clients</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">useClients</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex flex-wrap mt-4&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w-full mb-12 px-4 h-full&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          {<span style="color:#a6e22e">clients</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">clients</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> (
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">ClientsTable</span> <span style="color:#a6e22e">clients</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">clients</span>} /&gt;
</span></span><span style="display:flex;"><span>          ) <span style="color:#f92672">:</span> (
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">Spinner</span> /&gt;
</span></span><span style="display:flex;"><span>          )}
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/blog/" >
    &copy;  Victor De Grandis Blog 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
